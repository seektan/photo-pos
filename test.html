<div id="container" style="width:500px; height:300px"></div>

<div id="drop_zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);" style="width:200px; height:50px">
  <p>Drag one or more files to this Drop Zone ...</p>
</div>
<style>
#preview img{width: 200px;margin: 10px;}
</style>
<div id="preview"></div>

<script src="https://cdn.jsdelivr.net/npm/exifr/dist/lite.umd.js"></script>
<script>
function b64toBlob(base64, contentType) {
  var sliceSize = 1024;
  var byteCharacters = atob(base64);
  var slicesCount = Math.ceil(byteCharacters.length / sliceSize);
  var byteArrays = new Array(slicesCount);
  for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {
    var begin = sliceIndex * sliceSize;
    var end = Math.min(begin + sliceSize, byteCharacters.length);
    var bytes = new Array(end - begin);
    for (var offset = begin, i = 0; offset < end; ++i, ++offset) {
      bytes[i] = byteCharacters[offset].charCodeAt(0);
    }
    byteArrays[sliceIndex] = new Uint8Array(bytes);
  }  
  return new Blob(byteArrays, { type: contentType || '' });
}

function dropHandler(ev) {
  ev.preventDefault();
  for (const file of ev.dataTransfer.files) {
    const reader = new FileReader();
    reader.addEventListener('load', (event) => {
      var img = document.createElement('img');
      var blob = b64toBlob(event.target.result.split(',')[1], 'image/jpg');
      var blobUrl = URL.createObjectURL(blob);
      img.src = blobUrl;
      preview.appendChild(img);
      window.exifr.parse(blobUrl).then(function(exif){
        if (!defaultPos) {
          defaultPos = [exif.latitude, exif.longitude];
          loadMap();
        }
        console.log('files exif: ', exif);
      });
    });
    reader.readAsDataURL(file);
  };
}
function dragOverHandler(ev) {
  ev.preventDefault();
}


var preview = document.getElementById('preview');
var defaultPos = null;
function initMap() {
  if (!defaultPos) return;
  var myLatlng = new qq.maps.LatLng(defaultPos[0], defaultPos[1]);
  var myOptions = {
    zoom: 13,
    center: myLatlng,
    mapTypeId: qq.maps.MapTypeId.ROADMAP
  }
  var map = new qq.maps.Map(document.getElementById("container"), myOptions);  
} 
function loadMap() {
  var script = document.createElement("script");
  script.type = "text/javascript";
  script.src = "https://map.qq.com/api/js?v=2.exp&key=D3SBZ-M37KQ-IU55Z-GZ45Q-6GBCV-OYB34&callback=initMap";
  document.body.appendChild(script);
}

</script>
